<%
const content = theme.footer.content?.replace('{author.name}', (config.author || 'Anonymity'))
  ?.replace('{theme.name}', stellar_info('name'))
  ?.replace('{theme.version}', stellar_info('version'))
  ?.replace('{theme.tree}', stellar_info('tree'));

function layoutDiv() {
  let el = '';
  el += `<footer class="page-footer${scrollreveal(' ')} footnote">`;
  el += '<hr>';
  // sitemap
  if (theme.footer.sitemap && Object.keys(theme.footer.sitemap).length > 0) {
    el += '<div class="sitemap">';
    for (const group of Object.keys(theme.footer.sitemap)) {
      const items = theme.footer.sitemap[group];
      if (!items || items.length === 0) {
        continue;
      }
      el += '<div class="sitemap-group">';
      el += `<span class="fs15">${group}</span>`;
      items.forEach((item) => {
        el += `<a href="${url_for(md_link(item))}">${__(md_text(item))}</a>`;
      });
      el += '</div>';
    }
    el += '</div>';
  }
  // footer
  el += '<div class="text">';
  if (content) {
    el += markdown(content);
  }
  el += '</div></footer>';
  return el;
}
%>
<%- layoutDiv() %>

<% if (theme.footer.social && Object.keys(theme.footer.social).length > 0) { %>
  <div class="social-icons">
    <% 
      // ÈÅçÂéÜ theme.footer.social ÂØπË±°
      for (const [key, item] of Object.entries(theme.footer.social)) {
    %>
      <a href="<%= item.url %>" class="social-icon">
        <%- item.icon %>
      </a>
    <% } %>
  </div>
<% } %>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    let currentMode = localStorage.getItem('weatherMode') || 'sun'; // Ëé∑Âèñ‰øùÂ≠òÁöÑÂ§©Ê∞îÊ®°ÂºèÔºåÈªòËÆ§ÊòØ 'sun'
    const weatherIcon = document.getElementById('toggleWeather');
    const statusMessage = document.createElement('div');
    statusMessage.style.position = 'fixed';
    statusMessage.style.top = '20px';
    statusMessage.style.left = '50%';
    statusMessage.style.transform = 'translateX(-50%)';
    statusMessage.style.padding = '10px 20px';
    statusMessage.style.backgroundColor = '#000';
    statusMessage.style.color = '#fff';
    statusMessage.style.borderRadius = '5px';
    statusMessage.style.display = 'none';
    statusMessage.style.zIndex = '9999';
    document.body.appendChild(statusMessage);

    // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞Â§©Ê∞îÂõæÊ†áÂÖÉÁ¥†ÂàôÈÄÄÂá∫
    if (!weatherIcon) return;

    // Ê†πÊçÆ currentMode ËÆæÁΩÆÂàùÂßãÂ§©Ê∞îÂõæÊ†áÂíåÁâπÊïà
    setWeatherMode(currentMode);

    // ÁªëÂÆöÁÇπÂáª‰∫ã‰ª∂ÔºåÂàáÊç¢Â§©Ê∞îÊ®°Âºè
    weatherIcon.closest('a').addEventListener('click', function(e) {
      e.preventDefault();

      // ÂàáÊç¢Â§©Ê∞îÊ®°Âºè
      if (currentMode === 'sun') {
        currentMode = 'snow';
        localStorage.setItem('weatherMode', 'snow');
      } else if (currentMode === 'snow') {
        currentMode = 'rain';
        localStorage.setItem('weatherMode', 'rain');
      } else if (currentMode === 'rain') {
        currentMode = 'sun';
        localStorage.setItem('weatherMode', 'sun');
      }

      setWeatherMode(currentMode); // Êõ¥Êñ∞Â§©Ê∞îÊ®°Âºè
    });

    // ËÆæÁΩÆÂ§©Ê∞îÊ®°Âºè
    function setWeatherMode(mode) {
      // Âç∏ËΩΩÂΩìÂâçÊâÄÊúâÁâπÊïà
      removeScripts();

      if (mode === 'snow') {
        weatherIcon.src = '/assets/icons/snow.svg';  // Êõ¥Êñ∞ÂõæÊ†á
        loadScript('snow');
        statusMessage.textContent = '‚ùÑÔ∏è Snow ‚ùÑÔ∏è'; // ÊòæÁ§∫Èõ™Ëä±ÊèêÁ§∫ËØç
      } else if (mode === 'rain') {
        weatherIcon.src = '/assets/icons/rain.svg';  // Êõ¥Êñ∞ÂõæÊ†á
        loadScript('rain');
        statusMessage.textContent = 'üåßÔ∏è Rain üåßÔ∏è'; // ÊòæÁ§∫Èõ®Â§©ÊèêÁ§∫ËØç
      } else if (mode === 'sun') {
        weatherIcon.src = '/assets/icons/sun.svg';  // Êõ¥Êñ∞ÂõæÊ†á
        statusMessage.textContent = '‚òÄÔ∏è Sun ‚òÄÔ∏è'; // ÊòæÁ§∫Â§™Èò≥ÊèêÁ§∫ËØç
      }

      // ÊòæÁ§∫Áä∂ÊÄÅÊ∂àÊÅØ
      statusMessage.style.display = 'block';
      setTimeout(() => {
        statusMessage.style.display = 'none';
      }, 3000); // ÊèêÁ§∫Ê°ÜÊ∂àÂ§±ÁöÑÂª∂Êó∂
    }

    // Âä†ËΩΩÁâπÊïàËÑöÊú¨
    function loadScript(mode) {
      if (mode === 'snow' && !window.__snow__) {
        const script = document.createElement('script');
        script.src = '/js/snow.js';
        script.defer = true;
        document.body.appendChild(script);
      } else if (mode === 'rain' && !window.__rain__) {
        const script = document.createElement('script');
        script.src = '/js/rain.js';
        script.defer = true;
        document.body.appendChild(script);
      }
    }

    // Ê∏ÖÈô§ÁâπÊïà
    function removeScripts() {
      if (window.__snow__) {
        clearInterval(window.__snow__.timer);
        if (window.__snow__.canvas) {
          window.__snow__.canvas.remove();
        }
        delete window.__snow__;
      }
      if (window.__rain__) {
        clearInterval(window.__rain__.timer);
        if (window.__rain__.canvas) {
          window.__rain__.canvas.remove();
        }
        delete window.__rain__;
      }
    }
  });
</script>